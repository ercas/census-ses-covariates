# census-ses-covariates

Scripts to aid in spatially joining longitudinal Census data

### Quick start

1. Run `measures.R` to generate longitudinal covariate tables.
2. Run `crosswalk.R` to generate simplified longitudinal shapefiles and corresponding crosswalks.
3. Spatially join your data to the longitudinal shapefiles. Joins may return more results than expected because the shapefiles encompass several years of revisions (see `crosswalk.R`).
4. Join the crosswalk tables on `GEOID` and `amended`.
5. Join the longitudinal covariate tables on `GEOID` and `year`.

See the `Setup` section of `validation.R` for a quick example. Note that nearest-neighbor joining is currently not supported.

### measures.R

This script uses the [totalcensus](https://github.com/GL-Li/totalcensus) package to extract selected Census summary table variables and generate additional metrics, such as inequality indices, for all available ACS 5-year estimate releases across all 50 states and the District of Columbia. These data are additionally combined into a single, nationwide, longitudinal data set in both long and wide format at both state and nationwide levels.

About 600 GB of space is required to run this script. The use of `totalcensus` rather than `tidycensus` was motivated by a desire to both relieve stress on the Census servers and allow for quick iterative updates.

### crosswalk.R

Aside from the major nationwide changes to TIGER/Line geographies made every 10 years to coinciding with each decennial Census, some minor changes are made in the intermittent years, for example:

* [In 2011](https://www.census.gov/programs-surveys/acs/technical-documentation/table-and-geography-changes/2011/geography-changes.html), 12 tracts in New York were renamed, 3 were changed and 1 was removed as a result of merging.
* [In 2012](https://www.census.gov/programs-surveys/acs/technical-documentation/table-and-geography-changes/2012/geography-changes.html), 7 tracts in Arizona were renamed.
* Also in 2012, 1 tract in California was removed and 1 tract was reinstated.

In addition to these changes, several more boundary changes have been made throughout the years, both documented and undocumented. The undocumented changes appear to be particularly prevalent in areas where the boundaries coincide with bodies of water.

This script generates simplified shapefiles and accompanying crosswalks that can be used to spatially join the longitudinal covariate tables generated by `measures.R` in a quick and efficient manner. The simplified shapefiles combine all revisions to the selected Census geographies into one shapefile per state and only keeps the reference year (2009) and subsequent amendments, to save on space and computing power. The crosswalk tables allow these few revisions to be joined to the full range of years for which measures have been generated.

### validation.R

This script contains some small tests for validating the generated tables and shapefiles against external sources. This script assumes that `measures.R` and `crosswalk.R` have been run already. Some tests may require Internet access.